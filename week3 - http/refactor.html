
<!doctype html>
<html lang="nl" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Studiemateriaal voor de module webtechnologie 2 van de Hanzehogeschool Groningen">
      
      
        <meta name="author" content="Bart Barnard en Ralf van den Broek">
      
      
        <link rel="canonical" href="https://hanze-hbo-ict.github.io/webtech2/week3%20-%20http/refactor.html">
      
      
        <link rel="prev" href="iteratie2.html">
      
      
        <link rel="next" href="../week4%20-%20mvc/iteratie3.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Refactoring - Webtechnologie 2</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#refactoring" class="md-skip">
          Ga naar inhoud
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Webtechnologie 2" class="md-header__button md-logo" aria-label="Webtechnologie 2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Webtechnologie 2
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Refactoring
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Zoeken" placeholder="Zoeken" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Zoeken">
        
        <button type="reset" class="md-search__icon md-icon" title="Leegmaken" aria-label="Leegmaken" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Zoeken initialiseren
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigatie" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Webtechnologie 2" class="md-nav__button md-logo" aria-label="Webtechnologie 2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Webtechnologie 2
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webtechnologie 2
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Week3   http
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Week3   http
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="iteratie1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iteratie 1: een volledige round-trip
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="iteratie2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteratie 2: Uitbreiden van ServerRequest en Response
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Refactoring
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="refactor.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Refactoring
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Inhoudsopgave">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhoudsopgave
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#de-klassen-serverrequest-request-en-message" class="md-nav__link">
    <span class="md-ellipsis">
      De klassen ServerRequest, Request en Message
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#de-klasse-response" class="md-nav__link">
    <span class="md-ellipsis">
      De klasse Response
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laatste-stappen" class="md-nav__link">
    <span class="md-ellipsis">
      Laatste stappen
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Week4   mvc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Week4   mvc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../week4%20-%20mvc/iteratie3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteratie 3: Model View Controller
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../week4%20-%20mvc/iteratie4.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteratie 4: meer paden
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../week4%20-%20mvc/iteratie5.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteratie 5: Controllers en Routers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../week4%20-%20mvc/iteratie6.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteratie 6: de klasse Route
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../week4%20-%20mvc/refactor.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Refactoring
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Inhoudsopgave">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhoudsopgave
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#de-klassen-serverrequest-request-en-message" class="md-nav__link">
    <span class="md-ellipsis">
      De klassen ServerRequest, Request en Message
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#de-klasse-response" class="md-nav__link">
    <span class="md-ellipsis">
      De klasse Response
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laatste-stappen" class="md-nav__link">
    <span class="md-ellipsis">
      Laatste stappen
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="refactoring">Refactoring<a class="headerlink" href="#refactoring" title="Permanent link">&para;</a></h1>
<p>Nu we een eenvoudige round-trip hebben kunnen maken, is het tijd om de code wat te verbeteren. Omdat we in deze eerste iteratie eigenlijk maar maar met drie klassen hebben gewerkt, hoeven we alleen deze maar te bekijken.</p>
<h2 id="de-klassen-serverrequest-request-en-message">De klassen <code>ServerRequest</code>, <code>Request</code> en <code>Message</code><a class="headerlink" href="#de-klassen-serverrequest-request-en-message" title="Permanent link">&para;</a></h2>
<p>De belangrijkste omissie die we in deze iteratie hebben laten liggen is dat we de exacte constructors van de superklassen van <code>ServerRequest</code> nog hebben genegeerd. Bestudeer de methoden uit de interface van de verschillende klassen om te kijken welke informatie in welke klasse moet worden opgeslagen. Zo heeft bijvoorbeeld de klasse <code>Request</code> een methode <code>getMethod()</code>, die de betreffende <a href="">htt-method</a> (<code>POST</code>, <code>GET</code>, <code>UPDATE</code>, <code>DELETE</code>, ...) als string teruggeeft.</p>
<p>Omdat we (nog) geen instantie van <code>Request</code> direct aanmaken, moeten we deze informatie tijdens het aanmaken van de subklasse, <code>ServerRequest</code> meegeven. Gelukkig hebben we in deze subklasse de beschikking over deze informatie: die kun je vinden in <code>$_SERVER['REQUEST_METHOD']</code>, die juist door deze klasse wordt geëncapsuleerd. </p>
<p>Een ander voorbeeld: de klasse <code>Message</code> heeft een methode <code>getHeaders()</code> die alle http-headers als array teruggeeft. Ook deze gegevens moeten via <code>ServerRequest</code> en <code>Request</code> aan de <code>Message</code> doorgegeven worden. Let op: alle http-headers zitten in de superglobal <code>$_SERVER</code>: dat zijn namelijk die gegevens uit deze array waarvan de <em>naam</em> (de <em>key</em>) met <code>HTTP_</code> begint. Je zult deze gegevens dus uit deze array moeten filteren en de liggende streepjes vervangen door koppeltekens.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Je kunt natuurlijk gewoon door de <code>$_SERVER</code> heen itereren, checken of de sleutel (<em>key</em>) begint met <code>HTTP_</code> en in dat geval de corresponderende waarde gebruiken. Maar je kunt ook gebruik maken van de methoden <a href=""><code>array_filter()</code></a> en <a href=""><code>array_map</code></a>.</p>
</div>
<p>Het is een klein beetje arbitrair waar je deze wijzigingen exact uitvoert, maar het is het netste als je dit doet in <code>ServerRequest</code>, zodat zowel <code>Request</code> als <code>Message</code> gewoon een nette array ontvangen.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We hebben het hierboven wel steeds over de superglobal, maar het is natuurlijk niet de bedoeling dat je <em>deze</em> gebruikt. Je moet telkens de geëncapsuleerde versie uit <code>ServerRequest</code> gebruiken.</p>
</div>
<p>Doe dit voor alle velden uit de verschillende klassen waarvan je ziet dat ze die gegevens nodig hebben. Als het goed is zul je zien dat de constructor van <code>ServerRequest</code> vijf superglobals nodig heeft. Let op dat de parameter <code>$body</code> in <code>Message</code> ook leeg kan zijn: een <code>GET</code>-request heeft in de regel geen body, net zo min als een <code>POST</code>-response.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>De klasse <code>Request</code> heeft een property van het type <code>UriInterface</code> nodig. Het is prima om die voor nu even optioneel te maken, of om hier ook een string in te kunnen zetten (gebruik hiervoor <code>UriInterface|string</code>): in [de volgende iteratie] gaan we hier uitgebreid op in.</p>
</div>
<h2 id="de-klasse-response">De klasse <code>Response</code><a class="headerlink" href="#de-klasse-response" title="Permanent link">&para;</a></h2>
<p>Ga door de methoden van <code>Response</code> om te onderzoeken welke velden deze klasse allemaal nodig heeft (feitelijk op dezelfde manier als hierboven). Let er ook op dat deze klasse ook overerft van <code>Message</code>, dus ook hier moeten we de constructor aanpassen zodat die <code>Message</code> op een goede manier wordt aangemaakt. </p>
<p>Zorg voor logische standaardwaarden van alle velden (<code>status-code</code> = 200, bijvoorbeeld, of <code>protocol-version</code> = "1.1"): dat maakt het aanmaken van instanties van deze klasse een stuk eenvoudiger.</p>
<p>In de vorige iteratie hebben we gewoon <code>echo $response-&gt;getBody()</code> gebruikt om de response naar de client te sturen. Het is veel netter om hier een speciale statische functie voor te maken, die een <code>Response</code>-object ontvangt, de body hiervan uitprint en niet teruggeeft: dan hebben we fijn één specifieke plek waar we de boel naar de client terugsturen en weten we waar we op een later tijdstip moeten zijn om (bijvoorbeeld) de headers mee te sturen.</p>
<p>Maak in <code>Response</code> een methode <code>static send(Response $response)</code> die precies dit doet. Voor nu is het nog voldoende om gewoon die body uit te printen – op een later tijdstip gaan we dit nog wel (significant) aanpassen.</p>
<h2 id="laatste-stappen">Laatste stappen<a class="headerlink" href="#laatste-stappen" title="Permanent link">&para;</a></h2>
<p>Implementeer de methoden die nu nog commentaar hebben dat ze geïmplementeerd moeten worden.</p>
<p>Pas de <em>frontcontroller</em> aan, zodat deze gebruik maakt van de statische methode <code>Response::send()</code>.</p>
<p>Check opnieuw de werking van het geheel. Bij een refactorslag is het niet de bedoeling dat je nieuwe functionaliteit toevoegt, dus als het goed is, is er niks veranderd.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      HG 2025
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Gekopieerd naar klembord", "clipboard.copy": "Kopi\u00ebren naar klembord", "search.result.more.one": "1 extra overeenkomst op deze pagina", "search.result.more.other": "# extra overeenkomsten op deze pagina", "search.result.none": "Geen overeenkomende documenten", "search.result.one": "1 overeenkomende document", "search.result.other": "# overeenkomende documenten", "search.result.placeholder": "Typ om te beginnen met zoeken", "search.result.term.missing": "Ontbreekt", "select.version": "Selecteer versie"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../js/imgs.js"></script>
      
        <script src="../js/matjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>